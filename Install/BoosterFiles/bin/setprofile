#!/bin/sh

PROFILES="/home/booster/Profiles"

usage()
{
  echo "usage: $0 <profile> [<wireless IP>] - Sets the wireless network profile."
  exit 1
}

if [ $# -lt 1 ] || [ $# -gt 2 ]; then
  usage
fi

if [ ! -e "${PROFILES}/$1" ]; then
  echo "Profile '$1' does not exist."
  usage
fi

if [ $(id -u) -ne 0 ]; then
  exec sudo $0 "$@"
fi

if [ -s "${PROFILES}/$1" ]; then
  ssid=$(sed -ne "s/^\"\(.*\)\":$/\1/p" "${PROFILES}/$1")
  password=$(sed -ne "s/^  password: \"\(.*\)\"$/\1/p" "${PROFILES}/$1")
  nmcli connection modify B-Human 802-11-wireless.ssid "${ssid}"
  nmcli connection modify B-Human 802-11-wireless-security.psk "${password}"
  nmcli --wait 0 connection down B-Human 2>/dev/null
  if [ "$(nmcli radio wifi)" = "disabled" ]; then
    nmcli radio wifi on
    sleep 0.5
  fi
  nmcli --wait 0 connection up B-Human
else
  nmcli radio wifi off
fi
